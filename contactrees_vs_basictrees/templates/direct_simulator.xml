<?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE note [
    <!ENTITY blockrange "0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99">
]>
<beast version='2.0'
       namespace='beast.evolution.tree
                 :beast.evolution.tree.coalescent
                 :beast.evolution.alignment
                 :beast.evolution.sitemodel
                 :beast.evolution.substitutionmodel
                 :beast.core
                 :beast.core.parameter
                 :contactrees
                 :contactrees.model
                 :contactrees.util'>


<!-- DATA -->
<plate var="x" range="&blockrange;">
    <data id="simulated.block.$(x)" dataType="binary">
        {{#taxa}}
        <sequence taxon="{{.}}" totalcount="2">?</sequence>
        {{/taxa}}
    </data>
</plate>



<!-- MAP BLOCK -->
<map name="Uniform">beast.math.distributions.Uniform</map>
<map name="Exponential">beast.math.distributions.Exponential</map>
<map name="LogNormal">beast.math.distributions.LogNormalDistributionModel</map>
<map name="Normal">beast.math.distributions.Normal</map>
<map name="Beta">beast.math.distributions.Beta</map>
<map name="Gamma">beast.math.distributions.Gamma</map>
<map name="LaplaceDistribution">beast.math.distributions.LaplaceDistribution</map>
<map name="prior">beast.math.distributions.Prior</map>
<map name="InverseGamma">beast.math.distributions.InverseGamma</map>
<map name="OneOnX">beast.math.distributions.OneOnX</map>


<!-- BLOCK-SET DECLARATION -->
<stateNode spec="BlockSet" id="allBlocks" network="@acg">
	<plate var="x" range="&blockrange;">
		<block spec="Block" id="block$(x).sim"/>
	</plate>
</stateNode>


<siteModel id="siteModel" spec="SiteModel">
{{{substitution_model}}}
</siteModel>
{{{clock_model}}}


<!-- STATE -->
<stateNode id="acg" spec="ConversionGraph">
    <taxonset id="taxa" spec="TaxonSet" alignment="@simulated.block.0"/>
    <trait id="dateTrait.t:acg" spec="beast.evolution.tree.TraitSet" traitname="date-backward">
        1 = 0.0,
        2 = 0.05,
        3 = 0.1,
        4 = 0.15,
        5 = 0.2,
        6 = 0.25,
        7 = 0.3,
        8 = 0.35,
        9 = 0.4,
        10 = 0.5
        <taxa idref="taxa"/>
    </trait>
</stateNode>
{{#parameters}}
{{{.}}}
{{/parameters}}

<!-- MCMC -->
<run spec="DirectSimulator" nSamples="{{nsamples}}">


 	

    <!-- PRIOR -->
    <distribution id="prior" spec="util.CompoundDistribution">

{{{population_model}}}

{{#priors}}
{{{.}}}
{{/priors}}

    </distribution>


    <!-- LOGGERS -->
    <logger id="tracelog"  spec="Logger" fileName="$(filebase).log" logEvery="1"
            sanitiseHeaders="true" sort="smart">
        <log idref="prior"/>
{{#logs}}
{{{.}}}
{{/logs}}
    </logger>

    <logger id="screenlog" spec="Logger" logEvery="1">
        <log idref="prior"/>
{{#logs}}
{{{.}}}
{{/logs}}
    </logger>

    <logger spec="Logger" fileName="$(filebase).trees" logEvery="1" mode="tree">
    	<log spec="ACGWithMetaDataLogger" network="@acg" blockSet="@allBlocks"/>
    </logger>
</run>
  
</beast>
